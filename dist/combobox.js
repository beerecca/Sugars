System.register([], function (_export) {
  'use strict';

  _export('comboBox', comboBox);

  function comboBox(object_name) {
    this.edit = document.getElementById(object_name);

    var ddl = document.getElementById(object_name).parentNode.getElementsByTagName('DIV');
    this.dropdownlist = ddl[0];

    this.currentitem = null;

    this.currentitemindex = null;

    this.visiblecount = 0;

    var parobject = this;

    var pick = document.getElementById(object_name).parentNode.getElementsByTagName('SPAN');
    pick[0].onclick = function () {
      if (parobject.dropdownlist.style.display !== 'block') {
        parobject.edit.focus();
      }
    };

    this.edit.onfocus = function () {
      parobject.dropdownlist.style.display = 'block';
    };

    var allowLoose = true;
    this.edit.onblur = function () {
      if (allowLoose) {
        setTimeout(function () {
          parobject.dropdownlist.style.display = 'none';
        }, 150);
      }
    };

    parobject.dropdownlist.onmousedown = function (event) {
      allowLoose = false;
      parobject.edit.blur();
      return false;
    };

    parobject.dropdownlist.onmouseup = function (event) {
      setTimeout(function () {
        allowLoose = true;
      }, 150);
      return false;
    };

    this.listitems = this.dropdownlist.getElementsByTagName('A');
    for (var i = 0; i < this.listitems.length; i++) {
      var t = i;

      this.listitems[i].onclick = function () {
        var upv = this.innerHTML;
        upv = upv.replace(/\<b\>/ig, '');
        upv = upv.replace(/\<\/b\>/ig, '');
        parobject.edit.value = upv;
        parobject.dropdownlist.style.display = 'none';
        return false;
      };

      this.listitems[i].onmouseover = function (e) {
        for (var i = 0; i < parobject.listitems.length; i++) {
          if (this == parobject.listitems[i]) {
            if (parobject.currentitem) {
              parobject.currentitem.className = parobject.currentitem.className.replace(/light/g, '');
            }
            parobject.currentitem = parobject.listitems[i];
            parobject.currentitemindex = i;
            parobject.currentitem.className += ' light';
          }
        }
      };
    };

    this.edit.onkeydown = function (e) {
      e = e || window.event;

      if (e.keyCode == 38) {
        var cn = 0;
        if (parobject.visiblecount > 0) {
          if (parobject.visiblecount == 1) {
            parobject.currentitemindex = parobject.listitems.length - 1;
          }
          do {
            parobject.currentitemindex--;
            cn++;
          } while (parobject.currentitemindex > 0 && parobject.listitems[parobject.currentitemindex].style.display == 'none');
          if (parobject.currentitemindex < 0) parobject.currentitemindex = parobject.listitems.length - 1;

          if (parobject.currentitem) {
            parobject.currentitem.className = parobject.currentitem.className.replace(/light/g, '');
          }
          parobject.currentitem = parobject.listitems[parobject.currentitemindex];
          parobject.currentitem.className += ' light';
          parobject.currentitem.scrollIntoView(false);
        }
        e.cancelBubble = true;
        if (navigator.appName != 'Microsoft Internet Explorer') {
          e.preventDefault();
          e.stopPropagation();
        }
        return false;
      } else if (e.keyCode == 40) {
          var ic = 0;
          if (parobject.visiblecount > 0) {
            do {
              parobject.currentitemindex++;
            } while (parobject.currentitemindex < parobject.listitems.length && parobject.listitems[parobject.currentitemindex].style.display == 'none');
            if (parobject.currentitemindex >= parobject.listitems.length) parobject.currentitemindex = 0;

            if (parobject.currentitem) {
              parobject.currentitem.className = parobject.currentitem.className.replace(/light/g, '');
            }
            parobject.currentitem = parobject.listitems[parobject.currentitemindex];
            parobject.currentitem.className += ' light';
            parobject.currentitem.scrollIntoView(false);
          }
          e.cancelBubble = true;
          if (navigator.appName != 'Microsoft Internet Explorer') {
            e.preventDefault();
            e.stopPropagation();
          }
          return false;
        }
    };
    this.edit.onkeyup = function (e) {
      e = e || window.event;
      if (e.keyCode == 13) {
        e.cancelBubble = true;

        if (parobject.visiblecount !== 0) {
          var upv = parobject.currentitem.innerHTML;
          upv = upv.replace(/\<b\>/ig, '');
          upv = upv.replace(/\<\/b\>/ig, '');
          parobject.edit.value = upv;
        }
        parobject.dropdownlist.style.display = 'none';

        return false;
      } else {
        parobject.dropdownlist.style.display = 'block';
        parobject.visiblecount = 0;
        if (parobject.edit.value === '') {
          for (var i = 0; i < parobject.listitems.length; i++) {
            parobject.listitems[i].style.display = 'block';
            parobject.visiblecount++;
            var pv = parobject.listitems[i].innerHTML;
            pv = pv.replace(/\<b\>/ig, '');
            parobject.listitems[i].innerHTML = pv.replace(/\<\/b\>/ig, '');
          }
        } else {
          var re = new RegExp('(' + parobject.edit.value + ')', "i");
          for (var i = 0; i < parobject.listitems.length; i++) {
            var pv = parobject.listitems[i].innerHTML;
            pv = pv.replace(/\<b\>/ig, '');
            pv = pv.replace(/\<\/b\>/ig, '');
            if (re.test(pv)) {
              parobject.listitems[i].style.display = 'block';
              parobject.visiblecount++;
              parobject.listitems[i].innerHTML = pv.replace(re, '<b>$1</b>');
            } else {
              parobject.listitems[i].style.display = 'none';
            }
          }
        }
      }
    };
  }

  return {
    setters: [],
    execute: function () {}
  };
});
//# sourceMappingURL=data:application/json;base64,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WyIvKiBcbiAgV2l0aCB0aGFua3MgdG8gaHR0cDovL3d3dy56b29ubWFuLmNvbS9wcm9qZWN0cy9jb21ib2JveFxuKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21ib0JveChvYmplY3RfbmFtZSkge1xuICAvLyBFZGl0IGVsZW1lbnQgY2FjaGUgXG4gIHRoaXMuZWRpdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9iamVjdF9uYW1lKTtcbiAgLy8gSXRlbXMgQ29udGFpbmVyIFxuICB2YXIgZGRsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob2JqZWN0X25hbWUpLnBhcmVudE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0RJVicpO1xuICB0aGlzLmRyb3Bkb3dubGlzdCA9IGRkbFswXTtcbiAgLy8gQ3VycmVudCBJdGVtXG4gIHRoaXMuY3VycmVudGl0ZW0gPSBudWxsO1xuICAvLyBDdXJyZW50IEl0ZW0gSW5kZXhcbiAgdGhpcy5jdXJyZW50aXRlbWluZGV4ID0gbnVsbDtcbiAgLy8gVmlzaWJsZSBJdGVtcyBDb3VudFxuICB0aGlzLnZpc2libGVjb3VudCA9IDA7XG4gIC8vIENsb3N1cmUgT2JqZWN0IFxuICB2YXIgcGFyb2JqZWN0ID0gdGhpczsgICBcbiAgLy8gUGlja2VyXG4gIHZhciBwaWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob2JqZWN0X25hbWUpLnBhcmVudE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ1NQQU4nKTtcbiAgcGlja1swXS5vbmNsaWNrID1mdW5jdGlvbiAoKSB7XG4gICAgaWYgKHBhcm9iamVjdC5kcm9wZG93bmxpc3Quc3R5bGUuZGlzcGxheSAhPT0gJ2Jsb2NrJykge1xuICAgICAgcGFyb2JqZWN0LmVkaXQuZm9jdXMoKTtcbiAgICB9XG4gIH07XG4gIC8vIFNob3cgSXRlbXMgd2hlbiBlZGl0IGdldCBmb2N1c1xuICB0aGlzLmVkaXQub25mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBwYXJvYmplY3QuZHJvcGRvd25saXN0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICB9O1xuXG4gIC8vIEhpZGUgSXRlbXMgd2hlbiBlZGl0IGxvc3QgZm9jdXNcbiAgdmFyIGFsbG93TG9vc2UgPSB0cnVlO1xuICB0aGlzLmVkaXQub25ibHVyID0gZnVuY3Rpb24gKCkge1xuICAgIGlmKGFsbG93TG9vc2UpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge3Bhcm9iamVjdC5kcm9wZG93bmxpc3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzt9LCAxNTApO1xuICAgIH1cbiAgfTtcbiAgXG4gIC8vIElFIGZpeFxuICBwYXJvYmplY3QuZHJvcGRvd25saXN0Lm9ubW91c2Vkb3duID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBhbGxvd0xvb3NlID0gZmFsc2U7XG4gICAgcGFyb2JqZWN0LmVkaXQuYmx1cigpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBwYXJvYmplY3QuZHJvcGRvd25saXN0Lm9ubW91c2V1cCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7YWxsb3dMb29zZSA9IHRydWU7fSwgMTUwKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLy8gR2V0IEl0ZW1zXG4gIHRoaXMubGlzdGl0ZW1zID0gdGhpcy5kcm9wZG93bmxpc3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0EnKTtcbiAgZm9yICh2YXIgaT0wO2kgPCB0aGlzLmxpc3RpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciB0ID0gaTtcbiAgICAvLyBCaW5kaW5nIENsaWNrIEV2ZW50XG4gICAgdGhpcy5saXN0aXRlbXNbaV0ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB1cHYgPSB0aGlzLmlubmVySFRNTDsgICBcbiAgICAgIHVwdiA9IHVwdi5yZXBsYWNlKC9cXDxiXFw+L2lnLCAnJyk7XG4gICAgICB1cHYgPSB1cHYucmVwbGFjZSgvXFw8XFwvYlxcPi9pZywgJycpO1xuICAgICAgcGFyb2JqZWN0LmVkaXQudmFsdWUgPSB1cHY7XG4gICAgICBwYXJvYmplY3QuZHJvcGRvd25saXN0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQmluZGluZyBPbk1vdXNlT3ZlciBFdmVudFxuICAgIHRoaXMubGlzdGl0ZW1zW2ldLm9ubW91c2VvdmVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGZvciAodmFyIGk9MDtpIDwgcGFyb2JqZWN0Lmxpc3RpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAodGhpcyA9PSBwYXJvYmplY3QubGlzdGl0ZW1zW2ldKSB7XG4gICAgICAgICAgaWYgKHBhcm9iamVjdC5jdXJyZW50aXRlbSkge1xuICAgICAgICAgICAgcGFyb2JqZWN0LmN1cnJlbnRpdGVtLmNsYXNzTmFtZSA9IHBhcm9iamVjdC5jdXJyZW50aXRlbS5jbGFzc05hbWUucmVwbGFjZSgvbGlnaHQvZywgJycpXG4gICAgICAgICAgfVxuICAgICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbSA9IHBhcm9iamVjdC5saXN0aXRlbXNbaV07XG4gICAgICAgICAgcGFyb2JqZWN0LmN1cnJlbnRpdGVtaW5kZXggPSBpO1xuICAgICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbS5jbGFzc05hbWUgKz0gJyBsaWdodCc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gQmluZGluZyBPbktleURvd24gRXZlbnRcbiAgdGhpcy5lZGl0Lm9ua2V5ZG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgZSA9IGUgfHwgd2luZG93LmV2ZW50OyAgXG4gICAgLy8gTW92ZSBTZWxlY3Rpb24gVXBcbiAgICBpZiAoZS5rZXlDb2RlID09IDM4KSB7XG4gICAgICAvLyB1cFxuICAgICAgdmFyIGNuID0wO1xuICAgICAgaWYgKHBhcm9iamVjdC52aXNpYmxlY291bnQgPiAwKSB7XG4gICAgICAgIGlmIChwYXJvYmplY3QudmlzaWJsZWNvdW50ID09IDEpIHtcbiAgICAgICAgICBwYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleCA9IHBhcm9iamVjdC5saXN0aXRlbXMubGVuZ3RoLTE7XG4gICAgICAgIH1cbiAgICAgICAgZG8ge1xuICAgICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbWluZGV4LS07XG4gICAgICAgICAgY24rKztcbiAgICAgICAgfSBcbiAgICAgICAgd2hpbGUgKHBhcm9iamVjdC5jdXJyZW50aXRlbWluZGV4PjAgJiYgcGFyb2JqZWN0Lmxpc3RpdGVtc1twYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleF0uc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpO1xuICAgICAgICBpZihwYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleCA8IDApIHBhcm9iamVjdC5jdXJyZW50aXRlbWluZGV4ID0gcGFyb2JqZWN0Lmxpc3RpdGVtcy5sZW5ndGgtMTtcbiAgICAgICAgXG4gICAgICAgIGlmIChwYXJvYmplY3QuY3VycmVudGl0ZW0pIHtcbiAgICAgICAgICBwYXJvYmplY3QuY3VycmVudGl0ZW0uY2xhc3NOYW1lID0gcGFyb2JqZWN0LmN1cnJlbnRpdGVtLmNsYXNzTmFtZS5yZXBsYWNlKC9saWdodC9nLCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyb2JqZWN0LmN1cnJlbnRpdGVtID0gcGFyb2JqZWN0Lmxpc3RpdGVtc1twYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleF07XG4gICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbS5jbGFzc05hbWUgKz0gJyBsaWdodCc7XG4gICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbS5zY3JvbGxJbnRvVmlldyhmYWxzZSk7XG4gICAgICB9XG4gICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XG4gICAgICBpZiAobmF2aWdhdG9yLmFwcE5hbWUgIT0gJ01pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlcicpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBNb3ZlIFNlbGVjdGlvbiBEb3duXG4gICAgZWxzZSBpZiAoZS5rZXlDb2RlID09IDQwKXtcbiAgICAgIC8vIGRvd25cbiAgICAgIHZhciBpYz0wO1xuICAgICAgaWYgKHBhcm9iamVjdC52aXNpYmxlY291bnQgPiAwKSB7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICBwYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleCsrO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChwYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleCA8IHBhcm9iamVjdC5saXN0aXRlbXMubGVuZ3RoICYmIHBhcm9iamVjdC5saXN0aXRlbXNbcGFyb2JqZWN0LmN1cnJlbnRpdGVtaW5kZXhdLnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKTtcbiAgICAgICAgaWYocGFyb2JqZWN0LmN1cnJlbnRpdGVtaW5kZXggPj0gcGFyb2JqZWN0Lmxpc3RpdGVtcy5sZW5ndGgpIHBhcm9iamVjdC5jdXJyZW50aXRlbWluZGV4ID0gMDtcbiAgICAgICAgXG4gICAgICAgIGlmIChwYXJvYmplY3QuY3VycmVudGl0ZW0pIHtcbiAgICAgICAgICBwYXJvYmplY3QuY3VycmVudGl0ZW0uY2xhc3NOYW1lID0gcGFyb2JqZWN0LmN1cnJlbnRpdGVtLmNsYXNzTmFtZS5yZXBsYWNlKC9saWdodC9nLCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyb2JqZWN0LmN1cnJlbnRpdGVtID0gcGFyb2JqZWN0Lmxpc3RpdGVtc1twYXJvYmplY3QuY3VycmVudGl0ZW1pbmRleF07XG4gICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbS5jbGFzc05hbWUgKz0gJyBsaWdodCc7XG4gICAgICAgIHBhcm9iamVjdC5jdXJyZW50aXRlbS5zY3JvbGxJbnRvVmlldyhmYWxzZSk7XG4gICAgICB9XG4gICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XG4gICAgICBpZiAobmF2aWdhdG9yLmFwcE5hbWUgIT0gJ01pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlcicpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgfTtcbiAgdGhpcy5lZGl0Lm9ua2V5dXAgPSBmdW5jdGlvbiAoZSkge1xuICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDsgIFxuICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcbiAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcbiAgICAgIC8vIGVudGVyXG4gICAgICBpZiAocGFyb2JqZWN0LnZpc2libGVjb3VudCAhPT0gMCkge1xuICAgICAgICB2YXIgdXB2ID0gcGFyb2JqZWN0LmN1cnJlbnRpdGVtLmlubmVySFRNTDsgICBcbiAgICAgICAgdXB2ID0gdXB2IC5yZXBsYWNlKC9cXDxiXFw+L2lnLCAnJyk7XG4gICAgICAgIHVwdiA9IHVwdiAucmVwbGFjZSgvXFw8XFwvYlxcPi9pZywgJycpO1xuICAgICAgICBwYXJvYmplY3QuZWRpdC52YWx1ZSA9IHVwdjtcbiAgICAgIH1cbiAgICAgIHBhcm9iamVjdC5kcm9wZG93bmxpc3Quc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgIFxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHBhcm9iamVjdC5kcm9wZG93bmxpc3Quc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBwYXJvYmplY3QudmlzaWJsZWNvdW50ID0gMDtcbiAgICAgIGlmIChwYXJvYmplY3QuZWRpdC52YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgZm9yICh2YXIgaT0wO2kgPCBwYXJvYmplY3QubGlzdGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgcGFyb2JqZWN0Lmxpc3RpdGVtc1tpXS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICBwYXJvYmplY3QudmlzaWJsZWNvdW50Kys7XG4gICAgICAgICAgdmFyIHB2ID0gcGFyb2JqZWN0Lmxpc3RpdGVtc1tpXS5pbm5lckhUTUw7XG4gICAgICAgICAgcHYgPSBwdi5yZXBsYWNlKC9cXDxiXFw+L2lnLCAnJyk7XG4gICAgICAgICAgcGFyb2JqZWN0Lmxpc3RpdGVtc1tpXS5pbm5lckhUTUwgPSBwdi5yZXBsYWNlKC9cXDxcXC9iXFw+L2lnLCAnJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCAnKCcrcGFyb2JqZWN0LmVkaXQudmFsdWUgKycpJyxcImlcIik7XG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgcGFyb2JqZWN0Lmxpc3RpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBwdiA9IHBhcm9iamVjdC5saXN0aXRlbXNbaV0uaW5uZXJIVE1MO1xuICAgICAgICAgIHB2ID0gcHYucmVwbGFjZSgvXFw8YlxcPi9pZywgJycpO1xuICAgICAgICAgIHB2ID0gcHYucmVwbGFjZSgvXFw8XFwvYlxcPi9pZywgJycpO1xuICAgICAgICAgIGlmICggcmUudGVzdChwdikgKSB7XG4gICAgICAgICAgICBwYXJvYmplY3QubGlzdGl0ZW1zW2ldLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgcGFyb2JqZWN0LnZpc2libGVjb3VudCsrO1xuICAgICAgICAgICAgcGFyb2JqZWN0Lmxpc3RpdGVtc1tpXS5pbm5lckhUTUwgPSBwdi5yZXBsYWNlKHJlLCAnPGI+JDE8L2I+Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGFyb2JqZWN0Lmxpc3RpdGVtc1tpXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9